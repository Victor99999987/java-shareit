DROP TABLE IF EXISTS comments;
DROP TABLE IF EXISTS bookings;
DROP TABLE IF EXISTS items;
DROP TABLE IF EXISTS requests;
DROP TABLE IF EXISTS users;

CREATE TABLE IF NOT EXISTS users
(
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    name  VARCHAR(200) NOT NULL,
    email VARCHAR(200) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS requests
(
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    description  VARCHAR(1000) NOT NULL,
    requestor_id BIGINT NOT NULL REFERENCES users(id
)
ON
DELETE CASCADE,
created TIMESTAMP WITHOUT TIME ZONE NOT NULL
)
;

CREATE TABLE IF NOT EXISTS items
(
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    name        VARCHAR(200) NOT NULL,
    description VARCHAR(1000) NOT NULL,
    available   BOOLEAN NOT NULL,
    owner_id    BIGINT NOT NULL REFERENCES users(id
)
ON
DELETE CASCADE,
request_id BIGINT REFERENCES requests(id)ON
DELETE
SET NULL
);

CREATE TABLE IF NOT EXISTS bookings
(
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
start_date  TIMESTAMP WITHOUT TIME ZONE NOT NULL,
end_date  TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    item_id BIGINT NOT NULL REFERENCES items(id
)
ON
DELETE CASCADE,
booker_id BIGINT NOT NULL REFERENCES users(id)ON
DELETE CASCADE,
status VARCHAR(10)NOT NULL
);

CREATE TABLE IF NOT EXISTS comments
(
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    text    VARCHAR(1000) NOT NULL,
    item_id BIGINT NOT NULL REFERENCES items(id
)
ON
DELETE CASCADE,
author_id BIGINT NOT NULL REFERENCES users(id)ON
DELETE CASCADE,
created TIMESTAMP WITHOUT TIME ZONE NOT NULL
)
;
